# service-broker-kafka

Small proof of concept on how to route log messages from one app to a log
consumer through a kafka broker

## How kafka works

See [this](https://medium.com/swlh/apache-kafka-what-is-and-how-it-works-e176ab31fcd5)

## how to run the broker

- install docker, docker-compose

```bash
cd service-broker-kafka
docker compose -f docker-compose-dev.yml up
```

Install [intellij kafka plugin](https://plugins.jetbrains.com/plugin/21704-kafka)
or any other kafka client

Connect on port **9094**

## how to run the service-producer-1

- install java-jdk-17, some IDE (intellij is better)

```bash
cd service-producer-1
sh ./gradlew build ; sh ./gradlew bootRun
```

First producer uses default logback logging spring boot subsystem (and does not
work yet)

## how to run the service-producer-2

- install java-jdk-17, some IDE (intellij is better)

```bash
cd service-producer-2
sh ./gradlew build ; sh ./gradlew bootRun
```

Second producer uses log4j2 logging spring boot subsystem and logs messages to
a kafka topic in a transparent way. Just log your message and go home.

There is an issue where it starts to log warnings generated by kafka producer
itself, and then it enters into an infinite loop. I am working on it.

## how to run the service-consumer-1

- install java-jdk-17, some IDE (intellij is better)

```bash
cd service-producer-2
sh ./gradlew build ; sh ./gradlew bootRun
```

Kafka consumers subscribes to topics and then starts to consume them in real
time. 

That means you're not supposed to consume kafka streams in the main thread of a
web server, it will hang.

So this service is different.
